물리 계층과 데이터 링크 계층은 서로 밀접하게 연관되어 있는데 두 계층 모두 이더넷이라는 공통 기술을 사용하기 때문이다.
## 1. 이더넷 

LAN 환경에서 가장 대중적으로 사용하는 기술

다양한 통신 매체의 규격들과 송수신되는 프레임의 형태, 프레임을 주고 받는 방법이 정의된 네트워크 기술
### 이더넷 표준

이더넷은 표준화가 되어 있는데 전기전자공학자협회라는 국제 조직에서 이더넷 관련 기술을 IEEE 802.3으로 표준화했다.(이더넷 관련 표준들의 모음)

### 이더넷 프레임

이더넷 네트워크에서 주고받는 이더넷 프레임은 형식이 정해져 있다.

헤더 정보부터 살펴보자

#### 프리앰블

이더넷 프레임의 시작을 알리는 8바이트 크기의 정보이다. 수신지는 프리앰플을 통해 이더넷 프레임이 오고 있음을 알아차린다. 즉, 송수신지 간의 동기화를 위해 사용되는 정보이다.

#### 수신지 MAC 주소와 송신지 MAC 주소

MAC 주소는 데이터 링크 계층의 핵심으로 **LAN 내의 수신자와 송신지를 특정할 수 있다.**

MAC 주소는 일반적으로 고유하고, 변경되지 않는 주소로 네트워크 인터페이스마다 부여된다. (6바이트 길이의 주소)

보통 NIC(Network Interface Controller)라는 장치가 네크워크 인터페이스 역할을 담당한다. NIC가 컴퓨터에 여러 개 있으면 MAC 주소도 여러 개 있을 수 있다. 

#### 타입/길이

해당 필드에는 타입과 길이가 올 수 있는데 타입은 이더넷 프레임이 어떤 정보를 캡슐화했는지를 나타내는 정보이다. 대표적으로 상위 계층에서 사용된 프로토콜의 이름이 명시된다.

#### 데이터

데이터는 상위 계층에서 전달받거나 상위 계층으로 전달해야 될 내용이다. 반드시 46바이트 이상이여야 하는데 그 이하의 데이터면 패딩(padding)이 채워진다.

#### FCS

수신한 이더넷 프레임에 오류가 있는지 확인하기 위한 필드이다. 여기서 오류 검출이 이뤄진다.

---

## 2. NIC

NIC는 호스트와 통신 매체를 연결하고, MAC 주소가 부여되는 네트워크 장비이다. (네트워크 장비에도 연결할 수 있다)

NIC는 호스트가 신호를 제대로 이해할 수 있도록 통신 매체를 통해 전달되는 신호와 컴퓨터가 이해할 수 있는 정보 간에 변환을 담당한다.

#### NIC의 역할

통신 매체에 흐르는 신호를 호스트가 이해하는 프레임으로 변환하거나 반대로 호스트가 이해하는 프레임을 통신 매체에 흐르는 신호로 변환한다.

호스트가 네트워크를 통해 송수신하는 정보는 NIC를 거치게 되는데 이런 점에서 네트워크 인터페이스 역할을 수행한다고 할 수 있다.

---

## 3. 허브

통신 매체를 통해 송수신되는 메시지는 네트워크 장비를 거칠 수 있는데 대표적으로 다음과 같다.

- 물리 계층(L1) - 허브
- 데이터 링크 계층(L2) - 스위치

먼저 허브의 특징과 동작 방식인 반이중 모드 통신에 대해 알아보자.

### 주소 개념이 없는 물리 계층

물리 계층은 주소의 개념이 없다. 송수신지를 특정할 수 있는 주소는 데이터 링크 계층부터 존재한다.

따라서, 물리 계층의 네트워크 장비는 송수신되는 정보를 조작/판단하지 않는다.

### 허브 

허브(hub)는 여러 대의 호스트를 연결하는 장치이다. 커넥터를 연결할 수 있는 연결 지점이 있는데 이를 포트(port)라고 한다.

포트에 호스트와 연결된 통신 매체를 연결할 수 있다.
![](https://velog.velcdn.com/images/holim0/post/82923a82-bdc9-41e3-8377-c72aeecf3f2c/image.png)


#### 허브의 특징

허브는 오늘날 인터넷 환경에서 잘 사용되지는 않지만 다음 중요한 특징을 가지고 있어 알아야 한다.

1. 전달받은 신호를 다른 모든 포트로 그대로 다시 보낸다. (수신지 특정 불가)
	- 호스트는 데이터 링크 계층에서 패킷의 MAC 주소를 확인하고 자신과 관련 없는 주소는 폐기한다.

2. 반이중 모드로 통신한다.
	- 1차선 도로처럼 송수신을 번갈아 가면서 하는 통신 방식이다.
	- A -> B로 메시지를 송신할 때 B -> A로 메시지 송신이 불가능하다.
	- 전이중 모드는 동시에 양방향으로 통신이 가능한 방식이다.

#### 콜리전 도메인

허브에 호스트가 많이 연결되어 있을 수록 충돌(collision) 발생 가능 성이 높다. 이렇게 충돌이 발생할 수 있는 영역을 **콜리전 도메인**이라고 한다.

허브에 연결된 모든 호스트는 같은 콜리전 도메인에 속한다.

충돌 문제를 해결하기 위해서는 CSMA/CD 프로토콜을 사용하거나 스위치 장비를 사용해야 한다.

### CSMA/CD

충돌이 발생하는 근본적인 이유는 허브가 반이중 모드로 통신하기 때문이다.

CSMA/CD는 반이중 이더넷 네트워크에서 충돌을 방지하는 대표적인 프로토콜이다.

CSMA/CD는 Carrier Sense Multiple Access with Collision Detection의 약자인데 각각 살펴보자.

1. CSMA/CD 프로토콜을 사용하는 반이중 이더넷 네트워크에서는 메시지를 보내 전에 현재 네크워크상에서 전송 중인지를 확인하는 이를 Carrier Sense(캐리어 감지)라고 한다.

2. 복수의 호스트가 네트워크에 접근하려는 상황을 MA(Mutiple Access, 다중 접근)라 한다.

3. 충돌이 발생하면 이를 검출하는데 이를 CD(Collision Detection, 충돌 감지)라 한다.
	- 충돌을 감지하면 전송이 중단되고 충돌이 발생했음을 알리는 jam signal을 보낸다. 그리고 일정 시간을 기다리고 다시 전송한다.

## 4. 스위치

충돌을 해결할 수 있는 근본적인 방법은 전달받은 신호를 수신지 호스트가 연결된 포트로만 내보내고 전이중 모드로 통신하면 된다.

이런 기능을 지원하는 네트워크 장비가 데이터 링크(L2)의 스위치이다.

전달 받은 신호를 원하는 포트로만 보낼 수 있는 것은 스위치가 MAC 주소를 학습할 수 있기 때문이다.


### 스위치

스위치는 데이터 링크 계층의 네트워크 장비이다. (L2 스위치라고도 한다.)

스위치의 여러 포트에는 호스트를 연결할 수 있는데, 허브와 유사하다. 하지만 허브와 달리 **MAC 주소를 학습해 특정 MAC 주소를 가진 호스트에만 프레임을 전달할 수 있고 전이중 모드의 통신을 지원한다.**

이더넷 네트워크 구성 시 자주 사용한다.

![](https://velog.velcdn.com/images/holim0/post/eb1f1ace-bad7-44a9-96e3-0d7d4317728e/image.png)

#### 스위치의 특징

연결된 호스트의 MAC 주소와의 관계를 기억하고 프레임을 전달할 수 있는데 이를 MAC 주소 학습이라고 한다.

스위치는 포트와 연결된 호스트의 MAC 주소 간의 연관 관계를 메모리 형태로 기억하는데 이런 정보를 MAC 주소 테이블이라고 한다.


### MAC 주소 학습

다음 스위치의 세 가지 기능을 통해 스위치가 원하는 수신지가 연결된 포트에만 프레임을 내보낸다.

- **플러딩** - 송신지 포트를 제외한 모든 포트로 프레임을 전송하는 것 (수신한 프레임의  목적지 주소를 모르는 경우)
- **포워딩과 필터링**
	- 포워딩 - 프레임이 전송될 포트에 실제로 프레임을 내보는 것
	- 필터링 - 전달받은 프레임을 어디로 내보내고 어디로 내보내지 않을지 결정하는 기능
- **에이징** - MAC 주소 테이블에 등록된 특정 포트에서 일정 시간 동안 프레임을 전송받지 못하면 해당 항목을 삭제하는 것


### VLAN(Virtual LAN)

한 대의 스위치로 가상의 LAN을 만드는 방법이 VLAN이다.

스위치에 연결된 호스트 중에서도 서로 메시지를 주고받을 일이 적거나 브로드캐스트 메시지를 받을 필요가 없어 굳이 같은 네트워크(LAN)에 속할 필요가 없는 호스트가 있다면 VLAN을 통해 분리할 수 있다.

VLAN을 구성하면 여러 대의 스위치가 있는 것처럼 논리적인 단위로 LAN을 구획할 수 있다.
![](https://velog.velcdn.com/images/holim0/post/b04565e3-c683-449b-9999-0c3ad52569b7/image.png)


#### 포트 기반 VLAN

사전에 특정 포트에 VLAN을 할당하고 해당 포트에 호스트를 연결함으로써 VLAN에 포함시킬 수 있다.

한 대의 스위치 기반으로 포트로 VLAN을 나누면 포트가 부족해질 수 있는 문제가 있다.

이때 해결을 위해 사용할 수 있는 방법이 **VLAN 트렁킹(VLAN Trunking)**이다.

이는 2대 이상의 VLAN 스위치를 효율적으로 연결하여 확장하는 방법인데 스위치 간의 통신을 위한 특별한 포트인 **트렁크 포트(trunk port)에 VLAN 스위치를 서로 연결하는 방식이다.**

![](https://velog.velcdn.com/images/holim0/post/6c8d3dc4-99d6-47ee-a758-af073bf3b738/image.png)


#### MAC 기반 VLAN

프레임 속 MAC 주소가 호스트사 속할 VLAN을 결정하는 방식이다.

호스트의 MAC 주소를 특정 VLAN에 할당하면 어떤 포트에 연결되든 해당 VLAN에 속한 호스트로 동작한다.

![](https://velog.velcdn.com/images/holim0/post/0292d605-23cd-4a51-9e3b-7b9f47acc823/image.png)
